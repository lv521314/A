
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨å°å²›âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C757D;
            --primary-light: #ADB5BD;
            --primary-dark: #495057;
            --accent: #5C636A;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --dark: #212529;
            --light: #F8F9FA;
            --gray: #6C757D;
            --border: #DEE2E6;
            --card-bg: rgba(248, 249, 250, 0.98);
            --sidebar-bg: #E9ECEF;
            --highlight: #6C757D;
            --gradient-primary: linear-gradient(135deg, #6C757D 0%, #ADB5BD 100%);
            --gradient-accent: linear-gradient(135deg, #5C636A 0%, #868E96 100%);
            --gradient-success: linear-gradient(135deg, #28A745 0%, #5CB85C 100%);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px rgba(0, 0, 0, 0.1);
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background-color: #F8F9FA;
            color: var(--dark);
            line-height: 1.5;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 2rem;
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            border-radius: 20px;
            margin: 10px;
            transition: all 0.3s ease;
        }

        /* å…³é”®è¯æ–¹å—æ ·å¼ */
        .keyword-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .keyword-tag {
            padding: 0.75rem;
            background-color: #E9ECEF;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        .nav-logo {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px;
            border-radius: 20px;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.4);
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* ç™»å½•é®ç½©å±‚æ ·å¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        
        .login-container {
            background-color: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            transform: scale(0.95);
            animation: scaleUp 0.3s ease-out forwards;
        }
        
        .login-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
            font-weight: 600;
        }
        
        .login-input {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
        }
        
        .login-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .login-btn:hover {
            background: linear-gradient(135deg, #495057 0%, #6C757D 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .login-error {
            color: var(--danger);
            margin-top: 1rem;
            font-size: 0.875rem;
            animation: shake 0.5s ease;
        }
        
        .login-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes scaleUp {
            to { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .app-container {
            padding: 2rem;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 0.2s forwards;
        }

        /* é¡µé¢å†…å®¹æ ·å¼ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--dark);
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card:nth-child(1) {
            background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(173, 181, 189, 0.1) 100%);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, rgba(253, 121, 168, 0.1) 0%, rgba(232, 67, 147, 0.1) 100%);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(92, 184, 92, 0.1) 100%);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            transition: all 0.3s ease;
        }

        /* å…³é”®è¯ç®¡ç† */
        .keyword-manager {
            margin-bottom: 1.5rem;
        }

        .keyword-search {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .keyword-search:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
        }

        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .keyword-tag {
            padding: 0.5rem 1rem;
            background-color: #E9ECEF;
            border-radius: 2rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            box-shadow: var(--shadow-sm);
        }

        .keyword-tag:hover {
            background-color: #DEE2E6;
            transform: translateY(-2px);
        }

        .keyword-tag.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 6px rgba(108, 117, 125, 0.3);
        }

        .custom-keywords {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            background-color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .blacklist-keywords {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            background-color: rgba(255, 255, 255, 0.8);
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .keyword-note {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 0.5rem;
        }

        /* åŒºåŸŸé€‰æ‹©å™¨ */
        .area-selector {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .area-option {
            padding: 0.75rem 1.5rem;
            background-color: #E9ECEF;
            border-radius: 2rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: var(--shadow-sm);
        }

        .area-option:hover {
            background-color: #DEE2E6;
            transform: translateY(-2px);
        }

        .area-option.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 6px rgba(108, 117, 125, 0.3);
        }

        /* å»¶è¿Ÿæ§åˆ¶ */
        .delay-control {
            margin-bottom: 1.5rem;
        }

        .delay-slider {
            width: 100%;
            margin: 1rem 0;
            -webkit-appearance: none;
            height: 0.5rem;
            border-radius: 0.25rem;
            background: #E9ECEF;
            outline: none;
            transition: all 0.3s ease;
        }

        .delay-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .delay-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--primary-dark);
        }

        .delay-value {
            font-weight: 600;
            color: var(--primary-dark);
            transition: all 0.3s ease;
        }

        /* åˆ·æ–°æ—¶é—´æ§åˆ¶ */
        .refresh-control {
            margin-bottom: 1.5rem;
        }

        .refresh-slider {
            width: 100%;
            margin: 1rem 0;
            -webkit-appearance: none;
            height: 0.5rem;
            border-radius: 0.25rem;
            background: #E9ECEF;
            outline: none;
            transition: all 0.3s ease;
        }

        .refresh-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .refresh-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #495057;
        }

        .refresh-value {
            font-weight: 600;
            color: var(--accent);
            transition: all 0.3s ease;
        }

        /* å¤é€‰æ¡† */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-container input {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* æŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            box-shadow: var(--shadow-sm);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #495057 0%, #6C757D 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border);
            color: var(--dark);
        }

        .btn-outline:hover {
            background-color: #E9ECEF;
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-danger {
            background: linear-gradient(135deg, #DC3545 0%, #C82333 100%);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #C82333 0%, #DC3545 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* æ—¥å¿—åŒºåŸŸ */
        .log-stream {
            height: 300px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: var(--radius);
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            border: 1px solid var(--border);
            background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            transition: all 0.3s ease;
        }

        .log-entry {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px dashed var(--border);
            animation: fadeIn 0.3s ease-out;
        }

        .log-time {
            color: var(--gray);
            margin-right: 0.5rem;
        }

        .log-message.success {
            color: var(--success);
            font-weight: 500;
        }

        .log-message.warning {
            color: var(--warning);
            font-weight: 500;
        }

        .log-message.error {
            color: var(--danger);
            font-weight: 500;
        }

        .log-message.highlight {
            color: var(--primary);
            font-weight: 600;
        }

        .log-message.info {
            color: var(--dark);
        }

        .log-message.refresh {
            color: var(--accent);
        }

        .log-message.order {
            color: var(--success);
            font-weight: 600;
        }

        /* è¡¨å•å…ƒç´  */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
        }

        /* è®°å½•è¡¨æ ¼ */
        .record-table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .record-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.875rem;
            background-color: var(--card-bg);
            transition: all 0.3s ease;
        }

        .record-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 0.75rem 1rem;
            text-align: left;
            position: sticky;
            top: 0;
            transition: all 0.3s ease;
        }

        .record-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .record-table tr:nth-child(even) {
            background-color: #F8F9FA;
        }

        .record-table tr:hover {
            background-color: #E9ECEF;
        }

        .records-summary {
            padding: 1rem;
            background-color: rgba(108, 117, 125, 0.1);
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .records-summary-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }

        .records-summary-label {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .records-summary-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--success);
            transition: all 0.3s ease;
        }

        /* æ–°å¢æ ·å¼ */
        .summary-card {
            background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(173, 181, 189, 0.1) 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .summary-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .summary-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .summary-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .summary-label {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            transition: all 0.3s ease;
        }
        
        .emoji-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 5px;
            transition: all 0.3s ease;
        }
        
        .status-settled {
            background: rgba(40, 167, 69, 0.2);
            color: #28A745;
        }
        
        .status-unsettled {
            background: rgba(255, 193, 7, 0.2);
            color: #DC3545;
        }
        
        .refresh-btn {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            background: rgba(108, 117, 125, 0.1);
            border-radius: 6px;
            color: var(--primary);
            font-size: 12px;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: rgba(108, 117, 125, 0.2);
        }
        
        .show-more {
            text-align: center;
            padding: 8px;
            color: var(--gray);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .show-more:hover {
            color: var(--primary);
        }

        /* æ€§èƒ½ç›‘æ§é¢æ¿ */
        .performance-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.9);
            border-radius: var(--radius);
            transition: all 0.3s ease;
        }
        .perf-metric {
            text-align: center;
        }
        .perf-value {
            font-size: 1.2rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        .perf-label {
            font-size: 0.75rem;
            color: var(--gray);
        }
        .dynamic-speed {
            width: 100%;
            height: 6px;
            background: linear-gradient(to right, #6C757D, #ADB5BD, #6C757D);
            margin-top: 0.5rem;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        .speed-indicator {
            height: 100%;
            background: var(--dark);
            width: 50%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: #E9ECEF;
            border-radius: 2rem;
            font-size: 0.875rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .indicator {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: var(--gray);
            transition: all 0.3s ease;
        }

        .indicator.active {
            background-color: var(--success);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
            animation: pulse 1.5s infinite;
        }

        /* æ–°å¢ä½™é¢æ˜¾ç¤ºæ ·å¼ */
        .balance-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .balance-item {
            text-align: center;
            flex: 1;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .balance-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }

        .balance-value {
            font-size: 1.25rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .performance-panel {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .top-nav {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
            }
            
            .nav-links {
                margin-top: 1rem;
                width: 100%;
                justify-content: space-between;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .area-selector {
                flex-direction: column;
            }
            
            .performance-panel {
                grid-template-columns: 1fr;
            }
            
            .balance-container {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* æ–°å¢åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(108, 117, 125, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        /* ä¼˜åŒ–è¡¨æ ¼è¡ŒåŠ¨ç”» */
        .table-row {
            transition: all 0.3s ease;
        }
        
        .table-row-enter {
            opacity: 0;
            transform: translateY(10px);
        }
        
        .table-row-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.3s ease;
        }
        
        /* ä¼˜åŒ–APIåŠ è½½çŠ¶æ€ */
        .api-loading {
            position: relative;
        }
        
        .api-loading::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é®ç½©å±‚ -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <h2 class="login-title">ğŸ”‘ å¡å¯†ç™»å½•ğŸ”‘</h2>
            <input type="text" class="login-input" id="cardKeyInput" placeholder="è¯·è¾“å…¥å¡å¯†">
            <button class="login-btn" id="loginBtn">ç™»å½•</button>
            <div class="login-error" id="loginError"></div>
        </div>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="top-nav" id="topNav" style="display: none;">
        <div class="nav-logo">ã…¤ã…¤ã…¤ã…¤ã…¤  ã…¤ ã…¤ ã…¤ã…¤âœ¨ å°å²›æŠ¢å•âœ¨</div>
        <div class="nav-links">
            <a href="#" class="nav-link active" data-tab="dashboard">âœ¨æŠ¢å•é¡µé¢âœ¨</a>
            <a href="#" class="nav-link" data-tab="settings">âœ¨ç”¨æˆ·ä¿¡æ¯âœ¨</a>
            <a href="#" class="nav-link" data-tab="records">âœ¨æŠ¢å•è®°å½•âœ¨</a>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- æ§åˆ¶å°æ ‡ç­¾é¡µ -->
        <div id="dashboard-tab" class="tab-content active fade-in">
            <div class="header">
                <h1 class="card-title"> â€â€â€â€ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ğŸš€æŠ¢å•æ§åˆ¶å°</h1>
<div class="status-indicator">
                    <div class="indicator"></div>
                    <span>ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ ã…¤ã…¤æœªè¿è¡Œ</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“Š å®æ—¶ç›‘æ§</h2>
                    <span id="lastUpdate">æœ€åæ›´æ–°: -</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥æŠ¢å•æˆåŠŸ</div>
                        <div class="stat-value" id="successCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æœªç»“ç®—æ€»é‡‘é¢</div>
                        <div class="stat-value" id="unsettledAmount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å·²ç»“ç®—æ€»é‡‘é¢</div>
                        <div class="stat-value" id="settledAmount">0</div>
                    </div>
                </div>
            </div>

            <div class="card keyword-manager">
                <div class="card-header">
                    <h2 class="card-title">ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ğŸ” è¿‡æ»¤è®¢å•ç®¡ç†ğŸ”</h2>
                </div>

                <div class="keyword-grid">
                    <button class="keyword-tag active">å¼€è’å•</button>
                    <button class="keyword-tag">æš‘å‡å¿«ä¹å•</button>
                    <button class="keyword-tag">ç‹—å®¶ä¸“å±æŠ¤èˆªå•</button>
                    <button class="keyword-tag">èµŒåˆ€å•</button>
                    <button class="keyword-tag">èµŒç‹—å•</button>
                    <button class="keyword-tag">èµŒé¸¡å•</button>
                    <button class="keyword-tag">æŠ¤èˆªåŠ å¼ºå•</button>
                    <button class="keyword-tag">å®éªŒåŸºåœ°ä¸“å±</button>
                    <button class="keyword-tag">çƒ½ç«è£éƒ½ä¸“å±</button>   
                    <button class="keyword-tag">å†°æ²³ç¦åŒºä¸“å±</button>   
                    <button class="keyword-tag">è‹å°”å—æ¸…å›¾å•</button>   
                    <button class="keyword-tag">è‹å°”å—é’»çŸ³å•</button>   
                    <button class="keyword-tag">é‡‘è‰²ç‹—ç‰Œå•</button>   
                    <button class="keyword-tag">è‡³å°ŠæŠ¤èˆªå•</button>
                    <button class="keyword-tag">ç‹™å‡»ä¿±ä¹éƒ¨å•</button>
                    <button class="keyword-tag">å¤§ç¥æŠ¤èˆªå•</button>
                    <button class="keyword-tag">èµŒè¶…çº§ç‰©èµ„ç®±</button>
                    <button class="keyword-tag">ä¿åº•BOSSé‡‘å…‰å•</button>
                    <button class="keyword-tag">ç»™æ‰“æ‰‹åŠ é¸¡è…¿</button>
                    <button class="keyword-tag">ç»™æ‰“æ‰‹åŠ æ±‰å ¡</button>                   
                    <button class="keyword-tag">ç»™æ‰“æ‰‹å–å¥¶èŒ¶</button>
                </div>
                
                <input type="text" class="custom-keywords" placeholder="è‡ªå®šä¹‰å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”" id="customKeywords">
                            </div>
            <input type="text" class="blacklist-keywords" placeholder="é»‘åå•ç”¨æˆ·å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”" id="blacklistKeywords">
                
            <div class="card">
                <div class="card-header">
                           <h2 class="card-title">ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ğŸŒ åŒºåŸŸé€‰æ‹©ğŸŒ</h2>
                </div>
                
                <div class="area-selector">
                    <button class="area-option active" data-area="all">å…¨éƒ¨åŒºåŸŸ</button>
                    <button class="area-option" data-area="Q">QåŒº</button>
                    <button class="area-option" data-area="V">VåŒº</button>
                </div>
            </div>

            <div class="card delay-control">
                <div class="card-header">
                    <h2 class="card-title">ã…¤ã…¤ã…¤ã…¤ã…¤ ã…¤ã…¤â±ï¸ æŠ¢å•å»¶è¿Ÿè®¾ç½®â±ï¸</h2>
                </div>
                
                <input type="range" class="delay-slider" id="delaySlider" min="1" max="50" value="15">
                <div>å½“å‰å»¶è¿Ÿ: <span class="delay-value" id="delayValue">150</span> æ¯«ç§’</div>
            </div>

            <div class="card refresh-control">
                <div class="card-header">
                    <h2 class="card-title">ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ğŸ”„ è®¢å•åˆ·æ–°é—´éš”ğŸ”„</h2>
                </div>
                
                <input type="range" class="refresh-slider" id="refreshSlider" min="0.1" max="2" step="0.1" value="1.5">
                <div>åˆ·æ–°é—´éš”: <span class="refresh-value" id="refreshValue">1.5</span> ç§’</div>
            </div>

            <div class="card">
                <div class="checkbox-container">
                    <input type="checkbox" id="autoStopCheckbox" checked>
                    <label for="autoStopCheckbox">æŠ¢åˆ°ä¸€å•åè‡ªåŠ¨åœæ­¢</label>
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="autoBlacklistCheckbox" checked>
                    <label for="autoBlacklistCheckbox">æŠ¢å•å¤±è´¥ååŠ å…¥é»‘åå•</label>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="startBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        å¼€å§‹æŠ¢å•
                    </button>
                    <button class="btn btn-outline" id="stopBtn" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="6" y="4" width="12" height="16" rx="1"></rect>
                        </svg>
                        åœæ­¢æŠ¢å•
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ğŸ“ å®æ—¶æ—¥å¿—ğŸ“</h2>
                    <button class="btn btn-outline" id="clearLogs">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        æ¸…ç©º
                    </button>
                </div>
                
                <div class="log-stream" id="logStream">
                    <div class="log-entry">
                        <span class="log-time">[ç³»ç»Ÿ]</span>
                        <span class="log-message info">ç­‰å¾…å¼€å§‹æŠ¢å•...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
        <div id="settings-tab" class="tab-content">
            <div class="header">
                <div class="balance-container" id="balanceContainer">
                    <div class="balance-item">
                        <div class="balance-label">ğŸ’°è´¦å·ä½™é¢ğŸ’°</div>
                        <div class="balance-value" id="accountBalance">åŠ è½½ä¸­...</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-label">ğŸ’°æç°ä½™é¢ğŸ’°</div>
                        <div class="balance-value" id="frozenBalance">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                <h1 class="card-title">âš™ï¸ è´¦å·è®¾ç½®</h1>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ” è´¦å·é…ç½®</h2>
                </div>
                
                <div class="form-group">
                    <label for="ids">ids (å¤šä¸ªIDç”¨é€—å·åˆ†éš”)</label>
                    <input type="text" id="ids" placeholder="ä¾‹å¦‚: 123456,789012">
                </div>
                
                <div class="form-group">
                    <label for="token">Token</label>
                    <input type="password" id="token" placeholder="è¯·è¾“å…¥token">
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="saveConfig">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1 2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        ä¿å­˜é…ç½®
                    </button>
                    <button class="btn btn-outline" id="loadConfig">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        åŠ è½½é…ç½®
                    </button>
                </div>
            </div>
        </div>

        <!-- æˆåŠŸè®°å½•æ ‡ç­¾é¡µ -->
        <div id="records-tab" class="tab-content">
            <div class="header">
                <h1 class="card-title">ğŸ“‹ æˆåŠŸè®°å½•</h1>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">âœ… æŠ¢å•æˆåŠŸè®°å½•</h2>
                    <button class="btn btn-danger" id="clearRecords">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        æ¸…ç©ºè®°å½•
                    </button>
                </div>
                
                <div class="records-summary">
                    <div class="records-summary-item">
                        <div class="records-summary-label">ç´¯è®¡æŠ¢å•</div>
                        <div class="records-summary-value" id="totalOrders">0</div>
                    </div>
                    <div class="records-summary-item">
                        <div class="records-summary-label">ç´¯è®¡é‡‘é¢</div>
                        <div class="records-summary-value" id="totalAmount">0</div>
                    </div>
                </div>
                
                <div class="record-table-container">
                    <table class="record-table">
                        <thead>
                            <tr>
                                <th>â° æ—¶é—´</th>
                                <th>ğŸ†” è®¢å•ID</th>
                                <th>ğŸŒ åŒºåŸŸ</th>
                                <th>ğŸ’¼ ç±»å‹</th>
                                <th>ğŸ’° é‡‘é¢</th>
                                <th>â±ï¸ å»¶è¿Ÿ</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTable">
                            <tr>
                                <td colspan="6">ğŸ“­ æš‚æ— è®°å½•</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- æœªç»“ç®—è®¢å•ä¿¡æ¯ -->
            <div class="card">
                <div class="card-header">
                    <div class="summary-header">
                        <span class="summary-icon">ğŸ“Š</span>
                        <h2 class="summary-title">æœªç»“ç®—è®¢å•</h2>
                        <span class="emoji-badge status-unsettled">å¾…ç»“ç®— (â—•â€¿â—•)</span>
                        <div class="refresh-btn" id="refreshUnsettledBtn">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                <path d="M3 3v5h5"></path>
                                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
                                <path d="M16 16h5v5"></path>
                            </svg>
                            åˆ·æ–°
                        </div>
                    </div>
                </div>
                
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">æœªç»“ç®—è®¢å•æ•°</div>
                        <div class="summary-value" id="unsettledCount">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ç´¯è®¡é‡‘é¢</div>
                        <div class="summary-value" id="unsettledTotalAmount">0</div>
                    </div>
                </div>
                
                <div class="record-table-container">
                    <table class="record-table">
                        <thead>
                            <tr>
                                <th>â° æ—¶é—´</th>
                                <th>ğŸ†” è®¢å•ID</th>
                                <th>ğŸŒ åŒºåŸŸ</th>
                                <th>ğŸ’¼ ç±»å‹</th>
                                <th>ğŸ’° é‡‘é¢</th>
                                <th>ğŸ“Œ çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="unsettledTable">
                            <tr>
                                <td colspan="6">ğŸ”„ åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="show-more" id="showMoreUnsettled">
                    ğŸš© åªæ˜¾ç¤ºå‰5æ¡è®¢å• (ç‚¹å‡»æ˜¾ç¤ºå…¨éƒ¨)
                </div>
            </div>

            <!-- å·²ç»“ç®—è®¢å•ä¿¡æ¯ -->
            <div class="card">
                <div class="card-header">
                    <div class="summary-header">
                        <span class="summary-icon">âœ…</span>
                        <h2 class="summary-title">å·²ç»“ç®—è®¢å•</h2>
                        <span class="emoji-badge status-settled">å·²å®Œæˆ (â˜…Ï‰â˜…)</span>
                        <div class="refresh-btn" id="refreshSettledBtn">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                <path d="M3 3v5h5"></path>
                                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
                                <path d="M16 16h5v5"></path>
                            </svg>
                            åˆ·æ–°
                        </div>
                    </div>
                </div>
                
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">å·²ç»“ç®—è®¢å•æ•°</div>
                        <div class="summary-value" id="settledCount">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ç´¯è®¡é‡‘é¢</div>
                        <div class="summary-value" id="settledTotalAmount">0</div>
                    </div>
                </div>
                
                <div class="record-table-container">
                    <table class="record-table">
                        <thead>
                            <tr>
                                <th>â° æ—¶é—´</th>
                                <th>ğŸ†” è®¢å•ID</th>
                                <th>ğŸŒ åŒºåŸŸ</th>
                                <th>ğŸ’¼ ç±»å‹</th>
                                <th>ğŸ’° é‡‘é¢</th>
                                <th>ğŸ“Œ çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="settledTable">
                            <tr>
                                <td colspan="6">ğŸ”„ åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="show-more" id="showMoreSettled">
                    ğŸš© åªæ˜¾ç¤ºå‰5æ¡è®¢å• (ç‚¹å‡»æ˜¾ç¤ºå…¨éƒ¨)
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨å®Œæ•´è®¢å•æ•°æ®
        let allUnsettledOrders = [];
        let allSettledOrders = [];
        let showFullUnsettled = false;
        let showFullSettled = false;
        let balanceRefreshInterval = null; // ç”¨äºå­˜å‚¨ä½™é¢è‡ªåŠ¨åˆ·æ–°çš„interval
        let apiRequestQueue = []; // APIè¯·æ±‚é˜Ÿåˆ—
        let isProcessingQueue = false; // æ˜¯å¦æ­£åœ¨å¤„ç†é˜Ÿåˆ—

        // æ–°å¢å¡å¯†éªŒè¯åŠŸèƒ½
        async function fetchValidCardKeys() {
            try {
                const response = await fetch('https://lv521314.github.io/A/00.txt');
                if (!response.ok) {
                    throw new Error('è·å–å¡å¯†åˆ—è¡¨å¤±è´¥');
                }
                const text = await response.text();
                return text.split('\n').map(key => key.trim()).filter(key => key);
            } catch (error) {
                console.error('è·å–å¡å¯†åˆ—è¡¨å‡ºé”™:', error);
                return [];
            }
        }

        // éªŒè¯å¡å¯†
        async function validateCardKey(key) {
            const validKeys = await fetchValidCardKeys();
            return validKeys.includes(key);
        }

        // ç™»å½•åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', async function() {
            const loginOverlay = document.getElementById('loginOverlay');
            const topNav = document.getElementById('topNav');
            const appContainer = document.getElementById('appContainer');
            const cardKeyInput = document.getElementById('cardKeyInput');
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            
            // æ¯æ¬¡åˆ·æ–°é¡µé¢éƒ½æ˜¾ç¤ºç™»å½•ç•Œé¢
            loginOverlay.style.display = 'flex';
            topNav.style.display = 'none';
            appContainer.style.display = 'none';
            
            loginBtn.addEventListener('click', async function() {
                const key = cardKeyInput.value.trim();
                if (!key) {
                    loginError.textContent = 'è¯·è¾“å…¥å¡å¯†';
                    return;
                }
                
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<span class="login-loading"></span>éªŒè¯ä¸­...';
                loginError.textContent = '';
                
                try {
                    const isValid = await validateCardKey(key);
                    if (isValid) {
                        loginOverlay.style.display = 'none';
                        topNav.style.display = 'flex';
                        appContainer.style.display = 'block';
                        initApp();
                    } else {
                        loginError.textContent = 'å¡å¯†æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥';
                    }
                } catch (error) {
                    loginError.textContent = 'éªŒè¯å¤±è´¥: ' + error.message;
                } finally {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ç™»å½•';
                }
            });
            
            // å›è½¦é”®ç™»å½•
            cardKeyInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loginBtn.click();
                }
            });
        });

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // æé€Ÿç‰ˆé…ç½®
            const config = {
                apiBaseUrl: "https://paidan.xlt666.club/yxdl/api",
                ids: [],
                token: '',
                baseDelay: 15,      // åŸºç¡€å»¶è¿Ÿ150ms
                minDelay: 1,       // æœ€å°å»¶è¿Ÿ100ms
                maxDelay: 30,       // æœ€å¤§å»¶è¿Ÿ300ms
                baseInterval: 150,  // åŸºç¡€é—´éš”1.5ç§’
                minInterval: 10,   // æœ€å°é—´éš”1ç§’
                areaFilter: 'all',
                keywords: ['å¼€è’å•'],
                customKeywords: '',
                blacklistKeywords: '',
                blacklistOrderIds: [],
                stopAfterSuccess: true,
                autoBlacklist: true, // æ–°å¢è‡ªåŠ¨é»‘åå•åŠŸèƒ½
                isRunning: false,
                stats: {
                    successCount: 0,
                    refreshCount: 0,
                    avgResponse: 0,
                    lastRequestTime: 0,
                    lastProcessTime: 0,
                    unsettledTotal: 0,  // æ–°å¢æœªç»“ç®—æ€»é‡‘é¢
                    settledTotal: 0      // æ–°å¢å·²ç»“ç®—æ€»é‡‘é¢
                },
                // æ™ºèƒ½è°ƒæ•´å‚æ•°
                speedFactor: 1.0,
                // ç¼“å­˜ç³»ç»Ÿ
                cache: {
                    orders: null,
                    expiry: 0,
                    duration: 2000    // 2ç§’ç¼“å­˜
                },
                // æ€§èƒ½è¿½è¸ª
                performance: {
                    requestTimes: [],
                    processTimes: []
                }
            };
            
            // ç‹¬ç«‹å­˜å‚¨æˆåŠŸè®°å½•
            let successRecords = JSON.parse(localStorage.getItem('permanentRecords') || '[]');
            
            // DOMå…ƒç´ 
            const idsInput = document.getElementById('ids');
            const tokenInput = document.getElementById('token');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const saveConfigBtn = document.getElementById('saveConfig');
            const loadConfigBtn = document.getElementById('loadConfig');
            const clearRecordsBtn = document.getElementById('clearRecords');
            const clearLogsBtn = document.getElementById('clearLogs');
            const autoStopCheckbox = document.getElementById('autoStopCheckbox');
            const autoBlacklistCheckbox = document.getElementById('autoBlacklistCheckbox');
            const indicator = document.querySelector('.indicator');
            const successCountEl = document.getElementById('successCount');
            const unsettledAmountEl = document.getElementById('unsettledAmount');
            const settledAmountEl = document.getElementById('settledAmount');
            const lastUpdateEl = document.getElementById('lastUpdate');
            const logStream = document.getElementById('logStream');
            const recordsTable = document.getElementById('recordsTable');
            const keywordTags = document.querySelectorAll('.keyword-tag');
            const customKeywordsInput = document.getElementById('customKeywords');
            const blacklistKeywordsInput = document.getElementById('blacklistKeywords');
            const keywordSearchInput = document.getElementById('keywordSearch');
            const areaOptions = document.querySelectorAll('.area-option');
            const delaySlider = document.getElementById('delaySlider');
            const delayValue = document.getElementById('delayValue');
            const refreshSlider = document.getElementById('refreshSlider');
            const refreshValue = document.getElementById('refreshValue');
            const navLinks = document.querySelectorAll('.nav-link');
            const tabContents = document.querySelectorAll('.tab-content');
            const totalOrdersEl = document.getElementById('totalOrders');
            const totalAmountEl = document.getElementById('totalAmount');
            const accountBalanceEl = document.getElementById('accountBalance');
            const frozenBalanceEl = document.getElementById('frozenBalance');
            
            // æ–°å¢ç”¨æˆ·ä¿¡æ¯ç›¸å…³DOMå…ƒç´ 
            const unsettledCountEl = document.getElementById('unsettledCount');
            const unsettledTotalAmountEl = document.getElementById('unsettledTotalAmount');
            const unsettledTable = document.getElementById('unsettledTable');
            const settledCountEl = document.getElementById('settledCount');
            const settledTotalAmountEl = document.getElementById('settledTotalAmount');
            const settledTable = document.getElementById('settledTable');
            const refreshUnsettledBtn = document.getElementById('refreshUnsettledBtn');
            const refreshSettledBtn = document.getElementById('refreshSettledBtn');
            const showMoreUnsettled = document.getElementById('showMoreUnsettled');
            const showMoreSettled = document.getElementById('showMoreSettled');
            
            // åˆå§‹åŒ–
            loadConfig();
            setupEventListeners();
            updateStatsDisplay();
            loadSuccessRecords();
            loadUnsettledOrders(); // åˆå§‹åŒ–æ—¶åŠ è½½æœªç»“ç®—è®¢å•
            loadSettledOrders();   // åˆå§‹åŒ–æ—¶åŠ è½½å·²ç»“ç®—è®¢å•
            addLog('ğŸ‰ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'info');
            
            // å®æ—¶æ›´æ–°æ—¶é—´æ˜¾ç¤º
            setInterval(() => {
                const now = new Date();
                lastUpdateEl.textContent = `æœ€åæ›´æ–°: ${now.toLocaleTimeString()}`;
            }, 1000);
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            function setupEventListeners() {
                // å¯¼èˆªèœå•åˆ‡æ¢
                navLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const tabId = this.dataset.tab;
                        
                        // æ›´æ–°å¯¼èˆªçŠ¶æ€
                        navLinks.forEach(nav => nav.classList.remove('active'));
                        this.classList.add('active');
                        
                        // æ›´æ–°å†…å®¹æ˜¾ç¤º
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${tabId}-tab`) {
                                content.classList.add('active');
                            }
                        });
                        
                        // å¦‚æœæ˜¯è®°å½•é¡µï¼Œåˆ·æ–°æ•°æ®
                        if (tabId === 'records') {
                            loadSuccessRecords();
                            loadUnsettledOrders();
                            loadSettledOrders();
                        }
                        
                        // å¦‚æœæ˜¯ç”¨æˆ·ä¿¡æ¯é¡µï¼Œå¯åŠ¨è‡ªåŠ¨åˆ·æ–°
                        if (tabId === 'settings') {
                            if (!balanceRefreshInterval) {
                                balanceRefreshInterval = startBalanceAutoRefresh();
                            }
                        } else {
                            // å¦‚æœä¸æ˜¯ç”¨æˆ·ä¿¡æ¯é¡µï¼Œæ¸…é™¤è‡ªåŠ¨åˆ·æ–°
                            if (balanceRefreshInterval) {
                                clearInterval(balanceRefreshInterval);
                                balanceRefreshInterval = null;
                            }
                        }
                    });
                });
                
                // å¼€å§‹æŠ¢å•
                startBtn.addEventListener('click', startOrderGrabber);
                
                // åœæ­¢æŠ¢å•
                stopBtn.addEventListener('click', stopOrderGrabber);
                
                // ä¿å­˜é…ç½®
                saveConfigBtn.addEventListener('click', saveConfig);
                
                // åŠ è½½é…ç½®
                loadConfigBtn.addEventListener('click', loadConfig);
                
                // æ¸…ç©ºæ—¥å¿—
                clearLogsBtn.addEventListener('click', function() {
                    logStream.innerHTML = '';
                    addLog('ğŸ§¹ æ—¥å¿—å·²æ¸…ç©º', 'info');
                });
                
                // æ¸…ç©ºè®°å½•
                clearRecordsBtn.addEventListener('click', function() {
                    if (confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æˆåŠŸè®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                        successRecords = [];
                        localStorage.setItem('permanentRecords', JSON.stringify(successRecords));
                        loadSuccessRecords();
                        addLog('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰æˆåŠŸè®°å½•', 'warning');
                    }
                });
                
                // å…³é”®è¯é€‰æ‹©
                keywordTags.forEach(tag => {
                    tag.addEventListener('click', function() {
                        this.classList.toggle('active');
                        config.keywords = getSelectedKeywords();
                        saveConfigToLocal();
                    });
                });
                
                // è‡ªå®šä¹‰å…³é”®è¯
                customKeywordsInput.addEventListener('change', function() {
                    config.customKeywords = this.value;
                    config.keywords = getSelectedKeywords();
                    saveConfigToLocal();
                });
                
                // é»‘åå•å…³é”®è¯
                blacklistKeywordsInput.addEventListener('change', function() {
                    config.blacklistKeywords = this.value;
                    saveConfigToLocal();
                });
                
                // åŒºåŸŸé€‰æ‹©
                areaOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        areaOptions.forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        config.areaFilter = this.dataset.area;
                        saveConfigToLocal();
                    });
                });
                
                // å»¶è¿Ÿæ»‘å—
                delaySlider.addEventListener('input', function() {
                    config.baseDelay = parseInt(this.value);
                    delayValue.textContent = this.value;
                    saveConfigToLocal();
                });
                
                // åˆ·æ–°é—´éš”æ»‘å—
                refreshSlider.addEventListener('input', function() {
                    config.baseInterval = parseFloat(this.value) * 1000; // è½¬æ¢ä¸ºæ¯«ç§’
                    refreshValue.textContent = this.value;
                    saveConfigToLocal();
                });
                
                // è‡ªåŠ¨é»‘åå•é€‰é¡¹
                autoBlacklistCheckbox.addEventListener('change', function() {
                    config.autoBlacklist = this.checked;
                    saveConfigToLocal();
                });
                
                // åˆ·æ–°æœªç»“ç®—è®¢å•
                refreshUnsettledBtn.addEventListener('click', loadUnsettledOrders);
                
                // åˆ·æ–°å·²ç»“ç®—è®¢å•
                refreshSettledBtn.addEventListener('click', loadSettledOrders);
                
                // æ˜¾ç¤ºæ›´å¤šæœªç»“ç®—è®¢å•
                showMoreUnsettled.addEventListener('click', function() {
                    showFullUnsettled = !showFullUnsettled;
                    renderUnsettledTable();
                });
                
                // æ˜¾ç¤ºæ›´å¤šå·²ç»“ç®—è®¢å•
                showMoreSettled.addEventListener('click', function() {
                    showFullSettled = !showFullSettled;
                    renderSettledTable();
                });
            }
            
            // è‡ªåŠ¨åˆ·æ–°ä½™é¢æ•°æ®
            function startBalanceAutoRefresh() {
                // å…ˆç«‹å³åˆ·æ–°ä¸€æ¬¡
                refreshBalanceData();
                
                // ç„¶åæ¯6ç§’åˆ·æ–°ä¸€æ¬¡
                const refreshInterval = setInterval(() => {
                    if (document.querySelector('#settings-tab').classList.contains('active')) {
                        refreshBalanceData();
                    }
                }, 6000);
                
                // è¿”å›interval IDä»¥ä¾¿åç»­æ¸…é™¤
                return refreshInterval;
            }

            // åˆ·æ–°ä½™é¢æ•°æ®
            async function refreshBalanceData() {
                if (config.ids.length > 0 && config.token) {
                    try {
                        const balance = await fetchAccountBalance(config.ids[0]);
                        accountBalanceEl.textContent = balance.brokerageMoney.toFixed(2);
                        frozenBalanceEl.textContent = balance.freezeMoney.toFixed(2);
                        addLog('ğŸ”„ ä½™é¢æ•°æ®å·²åˆ·æ–°', 'refresh');
                    } catch (error) {
                        console.error('åˆ·æ–°ä½™é¢å‡ºé”™:', error);
                    }
                }
            }
            
            // è·å–è´¦å·ä½™é¢
            async function fetchAccountBalance(memberId) {
                try {
                    const response = await fetchWithRetry(
                        `https://paidan.xlt666.club/yxdl/api/memberBalance/getInfo?memberId=${memberId}`, 
                        { headers: { "token": config.token } }
                    );
                    
                    if (!response.ok) throw new Error('è·å–ä½™é¢å¤±è´¥');
                    
                    const data = await response.json();
                    if (data.code === 200) {
                        return {
                            brokerageMoney: data.data.brokerageMoney || 0,
                            freezeMoney: data.data.freezeMoney || 0
                        };
                    } else {
                        throw new Error(data.msg || 'è·å–ä½™é¢å¤±è´¥');
                    }
                } catch (error) {
                    console.error('è·å–ä½™é¢å‡ºé”™:', error);
                    return { brokerageMoney: 0, freezeMoney: 0 };
                }
            }
            
            // å¸¦é‡è¯•æœºåˆ¶çš„fetchè¯·æ±‚
            async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response;
                } catch (error) {
                    if (retries > 0) {
                        await sleep(delay);
                        return fetchWithRetry(url, options, retries - 1, delay * 1.5);
                    } else {
                        throw error;
                    }
                }
            }
            
            function updateStatsDisplay() {
                successCountEl.textContent = config.stats.successCount;
                unsettledAmountEl.textContent = config.stats.unsettledTotal.toFixed(2);
                settledAmountEl.textContent = config.stats.settledTotal.toFixed(2);
            }
            
            // åŠ è½½æœªç»“ç®—è®¢å•
            async function loadUnsettledOrders() {
                if (!config.token || config.ids.length === 0) {
                    unsettledTable.innerHTML = '<tr><td colspan="6">ğŸ”’ è¯·å…ˆé…ç½®IDå’ŒToken</td></tr>';
                    return;
                }

                try {
                    const memberId = config.ids[0];
                    const headers = { "token": config.token };
                    allUnsettledOrders = [];
                    let totalAmount = 0;
                    
                    unsettledTable.innerHTML = '<tr><td colspan="6">â³ æ­£åœ¨åŠ è½½æœªç»“ç®—è®¢å•...</td></tr>';
                    
                    // åˆ†é¡µè·å–æ‰€æœ‰æœªç»“ç®—è®¢å•
                    for (let pageNum = 1; pageNum <= 10; pageNum++) {
                        const response = await fetchWithRetry(
                            `${config.apiBaseUrl}/order/myList?pageSize=10&pageNum=${pageNum}&memberId=${memberId}&status=3`, 
                            { headers }
                        );
                        
                        const data = await response.json();
                        if (data.rows && data.rows.length > 0) {
                            allUnsettledOrders = allUnsettledOrders.concat(data.rows);
                            
                            // è®¡ç®—æ€»é‡‘é¢
                            data.rows.forEach(order => {
                                const price = parseFloat((order.outPrice || "0").replace(/[^\d.-]/g, ""));
                                totalAmount += isNaN(price) ? 0 : price;
                            });
                        } else {
                            break;
                        }
                    }
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    unsettledCountEl.textContent = allUnsettledOrders.length;
                    unsettledTotalAmountEl.textContent = totalAmount.toFixed(2);
                    config.stats.unsettledTotal = totalAmount; // æ›´æ–°å…¨å±€ç»Ÿè®¡
                    updateStatsDisplay();
                    
                    // æ˜¾ç¤ºå‰5æ¡æˆ–å…¨éƒ¨
                    renderUnsettledTable();
                    
                    addLog(`ğŸ”„ å·²åŠ è½½ ${allUnsettledOrders.length} æ¡æœªç»“ç®—è®¢å•ï¼Œæ€»é‡‘é¢: ${totalAmount.toFixed(2)}`, 'success');
                } catch (error) {
                    console.error('åŠ è½½æœªç»“ç®—è®¢å•å‡ºé”™:', error);
                    unsettledTable.innerHTML = `<tr><td colspan="6">âŒ åŠ è½½å¤±è´¥: ${error.message}</td></tr>`;
                    addLog(`âŒ åŠ è½½æœªç»“ç®—è®¢å•å¤±è´¥: ${error.message}`, 'error');
                }
            }

            // åŠ è½½å·²ç»“ç®—è®¢å•
            async function loadSettledOrders() {
                if (!config.token || config.ids.length === 0) {
                    settledTable.innerHTML = '<tr><td colspan="6">ğŸ”’ è¯·å…ˆé…ç½®IDå’ŒToken</td></tr>';
                    return;
                }

                try {
                    const memberId = config.ids[0];
                    const headers = { "token": config.token };
                    allSettledOrders = [];
                    let totalAmount = 0;
                    
                    settledTable.innerHTML = '<tr><td colspan="6">â³ æ­£åœ¨åŠ è½½å·²ç»“ç®—è®¢å•...</td></tr>';
                    
                    // åˆ†é¡µè·å–æ‰€æœ‰å·²ç»“ç®—è®¢å•(æœ€å¤š500æ¡)
                    for (let pageNum = 1; pageNum <= 50; pageNum++) {
                        const response = await fetchWithRetry(
                            `${config.apiBaseUrl}/order/myList?pageSize=10&pageNum=${pageNum}&memberId=${memberId}&status=4`, 
                            { headers }
                        );
                        
                        const data = await response.json();
                        if (data.rows && data.rows.length > 0) {
                            allSettledOrders = allSettledOrders.concat(data.rows);
                            
                            // è®¡ç®—æ€»é‡‘é¢
                            data.rows.forEach(order => {
                                const price = parseFloat((order.outPrice || "0").replace(/[^\d.-]/g, ""));
                                totalAmount += isNaN(price) ? 0 : price;
                            });
                        } else {
                            break;
                        }
                    }
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    settledCountEl.textContent = allSettledOrders.length;
                    settledTotalAmountEl.textContent = totalAmount.toFixed(2);
                    config.stats.settledTotal = totalAmount; // æ›´æ–°å…¨å±€ç»Ÿè®¡
                    updateStatsDisplay();
                    
                    // æ˜¾ç¤ºå‰5æ¡æˆ–å…¨éƒ¨
                    renderSettledTable();
                    
                    addLog(`ğŸ”„ å·²åŠ è½½ ${allSettledOrders.length} æ¡å·²ç»“ç®—è®¢å•ï¼Œæ€»é‡‘é¢: ${totalAmount.toFixed(2)}`, 'success');
                } catch (error) {
                    console.error('åŠ è½½å·²ç»“ç®—è®¢å•å‡ºé”™:', error);
                    settledTable.innerHTML = `<tr><td colspan="6">âŒ åŠ è½½å¤±è´¥: ${error.message}</td></tr>`;
                    addLog(`âŒ åŠ è½½å·²ç»“ç®—è®¢å•å¤±è´¥: ${error.message}`, 'error');
                }
            }

            // æ¸²æŸ“æœªç»“ç®—è¡¨æ ¼(å‰5æ¡æˆ–å…¨éƒ¨)
            function renderUnsettledTable() {
                const ordersToShow = showFullUnsettled ? allUnsettledOrders : allUnsettledOrders.slice(0, 3);
                
                if (ordersToShow.length === 0) {
                    unsettledTable.innerHTML = '<tr><td colspan="6">ğŸ›’ æš‚æ— æœªç»“ç®—è®¢å•</td></tr>';
                    return;
                }
                
                let html = '';
                ordersToShow.forEach(order => {
                    html += `
                        <tr class="table-row">
                            <td>${order.createTime ? new Date(order.createTime).toLocaleString() : 'â³ æœªçŸ¥'}</td>
                            <td>${order.taskId || 'ğŸ†” æœªçŸ¥'}</td>
                            <td>${order.categoryName || 'ğŸŒ æœªçŸ¥'}</td>
                            <td>${order.taskName || 'ğŸ’¼ æœªçŸ¥'}</td>
                            <td>${order.outPrice || '0.00'} ğŸ’°</td>
                            <td><span class="emoji-badge status-unsettled">å¾…ç»“ç®—</span></td>
                        </tr>
                    `;
                });
                
                unsettledTable.innerHTML = html;
                showMoreUnsettled.textContent = 
                    showFullUnsettled ? 'ğŸ‘† æ˜¾ç¤ºå…¨éƒ¨è®¢å•' : `ğŸš© åªæ˜¾ç¤ºå‰5æ¡è®¢å• (å…±${allUnsettledOrders.length}æ¡)`;
            }

            // æ¸²æŸ“å·²ç»“ç®—è¡¨æ ¼(å‰5æ¡æˆ–å…¨éƒ¨)
            function renderSettledTable() {
                const ordersToShow = showFullSettled ? allSettledOrders : allSettledOrders.slice(0, 3);
                
                if (ordersToShow.length === 0) {
                    settledTable.innerHTML = '<tr><td colspan="6">ğŸ“­ æš‚æ— å·²ç»“ç®—è®¢å•</td></tr>';
                    return;
                }
                
                let html = '';
                ordersToShow.forEach(order => {
                    html += `
                        <tr class="table-row">
                            <td>${order.createTime ? new Date(order.createTime).toLocaleString() : 'â³ æœªçŸ¥'}</td>
                            <td>${order.taskId || 'ğŸ†” æœªçŸ¥'}</td>
                            <td>${order.categoryName || 'ğŸŒ æœªçŸ¥'}</td>
                            <td>${order.taskName || 'ğŸ’¼ æœªçŸ¥'}</td>
                            <td>${order.outPrice || '0.00'} ğŸ’°</td>
                            <td><span class="emoji-badge status-settled">å·²ç»“ç®—</span></td>
                        </tr>
                    `;
                });
                
                settledTable.innerHTML = html;
                showMoreSettled.textContent = 
                    showFullSettled ? 'ğŸ‘† æ˜¾ç¤ºå…¨éƒ¨è®¢å•' : `ğŸš© åªæ˜¾ç¤ºå‰5æ¡è®¢å• (å…±${allSettledOrders.length}æ¡)`;
            }
            
            // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
            function saveConfigToLocal() {
                const configToSave = {
                    ids: config.ids,
                    token: config.token,
                    baseDelay: config.baseDelay,
                    baseInterval: config.baseInterval,
                    areaFilter: config.areaFilter,
                    keywords: config.keywords,
                    customKeywords: config.customKeywords,
                    blacklistKeywords: config.blacklistKeywords,
                    blacklistOrderIds: config.blacklistOrderIds,
                    stopAfterSuccess: config.stopAfterSuccess,
                    autoBlacklist: config.autoBlacklist
                };
                localStorage.setItem('orderGrabberConfig', JSON.stringify(configToSave));
            }
            
            // åŠ è½½é…ç½®
            async function loadConfig() {
                const savedConfig = localStorage.getItem('orderGrabberConfig');
                if (savedConfig) {
                    try {
                        const parsedConfig = JSON.parse(savedConfig);
                        
                        // æ›´æ–°é…ç½®å¯¹è±¡
                        config.ids = Array.isArray(parsedConfig.ids) 
                            ? parsedConfig.ids 
                            : (parsedConfig.ids || '').split(',').filter(id => id.trim()).map(id => parseInt(id.trim()));
                        config.token = parsedConfig.token || '';
                        config.baseDelay = parsedConfig.baseDelay || 150;
                        config.baseInterval = parsedConfig.baseInterval || 1500;
                        config.areaFilter = parsedConfig.areaFilter || 'all';
                        config.keywords = parsedConfig.keywords || ['å¼€è’å•'];
                        config.customKeywords = parsedConfig.customKeywords || '';
                        config.blacklistKeywords = parsedConfig.blacklistKeywords || '';
                        config.blacklistOrderIds = parsedConfig.blacklistOrderIds || [];
                        config.stopAfterSuccess = parsedConfig.stopAfterSuccess !== false;
                        config.autoBlacklist = parsedConfig.autoBlacklist !== false;
                        
                        // æ›´æ–°UI
                        idsInput.value = Array.isArray(parsedConfig.ids) 
                            ? parsedConfig.ids.join(',') 
                            : (parsedConfig.ids || '');
                        tokenInput.value = config.token;
                        autoStopCheckbox.checked = config.stopAfterSuccess;
                        autoBlacklistCheckbox.checked = config.autoBlacklist;
                        delaySlider.value = config.baseDelay;
                        delayValue.textContent = config.baseDelay;
                        refreshSlider.value = config.baseInterval / 1000;
                        refreshValue.textContent = config.baseInterval / 1000;
                        customKeywordsInput.value = config.customKeywords;
                        blacklistKeywordsInput.value = config.blacklistKeywords;
                        
                        // æ¢å¤å…³é”®è¯æŒ‰é’®çŠ¶æ€
                        keywordTags.forEach(tag => {
                            if (config.keywords.includes(tag.textContent)) {
                                tag.classList.add('active');
                            } else {
                                tag.classList.remove('active');
                            }
                        });
                        
                        // æ¢å¤åŒºåŸŸé€‰æ‹©
                        areaOptions.forEach(option => {
                            if (option.dataset.area === config.areaFilter) {
                                option.classList.add('active');
                            } else {
                                option.classList.remove('active');
                            }
                        });

                        // å¦‚æœæœ‰IDå’Œtokenï¼ŒåŠ è½½ä½™é¢
                        if (config.ids.length > 0 && config.token) {
                            const balance = await fetchAccountBalance(config.ids[0]);
                            accountBalanceEl.textContent = balance.brokerageMoney.toFixed(2);
                            frozenBalanceEl.textContent = balance.freezeMoney.toFixed(2);
                        }
                        
                        addLog('âš™ï¸ é…ç½®åŠ è½½æˆåŠŸ', 'success');
                    } catch (e) {
                        addLog('âŒ é…ç½®åŠ è½½å¤±è´¥: ' + e.message, 'error');
                    }
                } else {
                    addLog('âš ï¸ æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„é…ç½®', 'warning');
                }
            }
            
            // ä¿å­˜é…ç½®
            async function saveConfig() {
                config.ids = idsInput.value.trim().split(',').filter(id => id.trim()).map(id => parseInt(id.trim()));
                config.token = tokenInput.value.trim();
                config.stopAfterSuccess = autoStopCheckbox.checked;
                config.autoBlacklist = autoBlacklistCheckbox.checked;
                config.keywords = getSelectedKeywords();
                config.blacklistKeywords = blacklistKeywordsInput.value.trim();
                
                saveConfigToLocal();

                // å¦‚æœæœ‰IDå’Œtokenï¼ŒåŠ è½½ä½™é¢
                if (config.ids.length > 0 && config.token) {
                    const balance = await fetchAccountBalance(config.ids[0]);
                    accountBalanceEl.textContent = balance.brokerageMoney.toFixed(2);
                    frozenBalanceEl.textContent = balance.freezeMoney.toFixed(2);
                }
                
                addLog('ğŸ’¾ é…ç½®å·²ä¿å­˜', 'success');
            }
            
            // è·å–é€‰ä¸­çš„å…³é”®è¯
            function getSelectedKeywords() {
                const keywords = [];
                
                // ä»å¿«æ·æŒ‰é’®è·å–
                document.querySelectorAll('.keyword-tag.active').forEach(tag => {
                    keywords.push(tag.textContent);
                });
                
                // ä»è‡ªå®šä¹‰è¾“å…¥è·å–
                if (customKeywordsInput.value.trim()) {
                    customKeywordsInput.value.trim().split(',').forEach(kw => {
                        if (kw.trim()) keywords.push(kw.trim());
                    });
                }
                
                return keywords;
            }
            
            // è·å–é»‘åå•å…³é”®è¯
            function getBlacklistKeywords() {
                if (!config.blacklistKeywords) return [];
                return config.blacklistKeywords.split(',').map(kw => kw.trim()).filter(kw => kw);
            }
            
            // æ™ºèƒ½åŠ¨æ€å»¶è¿Ÿè®¡ç®—
            function getDynamicDelay() {
                // æ ¹æ®æœ€è¿‘5æ¬¡çš„å¹³å‡å“åº”æ—¶é—´åŠ¨æ€è°ƒæ•´
                const lastRequests = config.performance.requestTimes.slice(-5);
                const avgRequest = lastRequests.reduce((a, b) => a + b, 0) / (lastRequests.length || 1);
                
                // æ ¹æ®APIå“åº”æ—¶é—´è°ƒæ•´å»¶è¿Ÿ
                let dynamicDelay = config.baseDelay;
                if (avgRequest > 500) {
                    // å¦‚æœAPIå“åº”æ…¢ï¼Œé€‚å½“å¢åŠ å»¶è¿Ÿé¿å…é¢‘ç¹è¯·æ±‚
                    dynamicDelay = Math.min(config.baseDelay * 1.5, config.maxDelay);
                } else if (avgRequest < 200) {
                    // å¦‚æœAPIå“åº”å¿«ï¼Œå¯ä»¥é€‚å½“å‡å°‘å»¶è¿Ÿ
                    dynamicDelay = Math.max(config.baseDelay * 0.8, config.minDelay);
                }
                
                // æ ¹æ®å½“å‰é€Ÿåº¦å› å­è°ƒæ•´
                dynamicDelay = Math.max(config.minDelay, Math.min(config.maxDelay, dynamicDelay * config.speedFactor));
                
                return Math.round(dynamicDelay);
            }
            
            // æ™ºèƒ½åŠ¨æ€é—´éš”è®¡ç®—
            function getDynamicInterval() {
                // æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´
                const lastProcessTimes = config.performance.processTimes.slice(-5);
                const avgProcess = lastProcessTimes.reduce((a, b) => a + b, 0) / (lastProcessTimes.length || 1);
                
                let dynamicInterval = config.baseInterval;
                if (avgProcess > 1000) {
                    // å¦‚æœå¤„ç†æ—¶é—´é•¿ï¼Œé€‚å½“å¢åŠ é—´éš”
                    dynamicInterval = Math.min(config.baseInterval * 1.3, 5000);
                } else if (avgProcess < 500) {
                    // å¦‚æœå¤„ç†æ—¶é—´çŸ­ï¼Œå¯ä»¥é€‚å½“å‡å°‘é—´éš”
                    dynamicInterval = Math.max(config.baseInterval * 0.7, config.minInterval);
                }
                
                return Math.round(dynamicInterval);
            }
            
            // å¼€å§‹æŠ¢å•
            function startOrderGrabber() {
                if (!config.token) {
                    addLog('âŒ è¯·å…ˆé…ç½®Tokenå¹¶ä¿å­˜', 'error');
                    return;
                }
                
                if (config.ids.length === 0) {
                    addLog('âŒ è¯·å…ˆé…ç½®idså¹¶ä¿å­˜', 'error');
                    return;
                }
                
                config.isRunning = true;
                config.stats = {
                    successCount: 0,
                    refreshCount: 0,
                    avgResponse: 0,
                    lastRequestTime: 0,
                    lastProcessTime: 0,
                    unsettledTotal: 0,
                    settledTotal: 0
                };
                
                // æ¸…ç©ºæ€§èƒ½æ•°æ®
                config.performance = {
                    requestTimes: [],
                    processTimes: []
                };
                
                // æ›´æ–°UI
                indicator.classList.add('active');
                indicator.nextElementSibling.textContent = 'è¿è¡Œä¸­';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'inline-flex';
                updateStatsDisplay();
                
                addLog('ğŸš€ å¼€å§‹æŠ¢å•...', 'highlight');
                addLog(`ğŸ” å½“å‰å…³é”®è¯: ${config.keywords.join(', ')}`, 'info');
                addLog(`ğŸš« é»‘åå•å…³é”®è¯: ${getBlacklistKeywords().join(', ') || 'æ— '}`, 'info');
                addLog(`ğŸŒ ç›®æ ‡åŒºåŸŸ: ${config.areaFilter === 'all' ? 'å…¨éƒ¨' : config.areaFilter + 'åŒº'}`, 'info');
                addLog(`â±ï¸ åŸºç¡€å»¶è¿Ÿ: ${config.baseDelay}ms`, 'info');
                addLog(`ğŸ”„ åŸºç¡€åˆ·æ–°é—´éš”: ${config.baseInterval/1000}ç§’`, 'info');
                
                // å¼€å§‹æŠ¢å•æµç¨‹
                ultraFastOrderGrabbing();
            }
            
            // æé€ŸæŠ¢å•æ ¸å¿ƒé€»è¾‘
            async function ultraFastOrderGrabbing() {
                while (config.isRunning) {
                    const cycleStart = Date.now();
                    let requestStart, requestEnd;
                    
                    try {
                        requestStart = Date.now();
                        
                        // 1. è·å–è®¢å•åˆ—è¡¨ï¼ˆå¸¦ç¼“å­˜æ£€æŸ¥ï¼‰
                        const orders = await fetchOrderListWithCache();
                        requestEnd = Date.now();
                        
                        const requestTime = requestEnd - requestStart;
                        config.performance.requestTimes.push(requestTime);
                        
                        config.stats.refreshCount++;
                        
                        // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
                        const now = new Date();
                        lastUpdateEl.textContent = `æœ€åæ›´æ–°: ${now.toLocaleTimeString()}`;
                        
                        addLog(`ğŸ”„ è·å–åˆ° ${orders.length} ä¸ªè®¢å• (${requestTime}ms)`, 'refresh');
                        
                        // 2. å¹¶è¡Œå¤„ç†è®¢å•è¿‡æ»¤
                        const processStart = Date.now();
                        const matchedOrders = await filterOrdersParallel(orders);
                        const processTime = Date.now() - processStart;
                        config.performance.processTimes.push(processTime);
                        
                        if (matchedOrders.length > 0) {
                            addLog(`ğŸ¯ å‘ç° ${matchedOrders.length} ä¸ªåŒ¹é…è®¢å•`, 'highlight');
                            
                            // 3. å°è¯•æŠ¢å•ï¼ˆå¹¶è¡Œå¤„ç†å‰3ä¸ªè®¢å•ï¼‰
                            const takeOrderPromises = matchedOrders.slice(0, 1).map(order => 
                                takeOrder(order.taskId).catch(e => {
                                    addLog(`âŒ æŠ¢å•å‡ºé”™: ${e.message}`, 'error');
                                    return null;
                                })
                            );
                            
                            const results = await Promise.all(takeOrderPromises);
                            
                            // å¤„ç†æŠ¢å•ç»“æœ
                            for (const result of results) {
                                if (!config.isRunning) break;
                                
                                if (result && result.success) {
                                    config.stats.successCount++;
                                    
                                    addLog(`âœ… æˆåŠŸè®¢å•: ${result.order.taskName}`, 'order');
                                    addLog(`ğŸ‘¤ è´¦å·åŒºåˆ†: ${result.order.categoryName}`, 'order');
                                    addLog(`ğŸ“ è¯¦æƒ…è®¢å•: ${result.order.description}`, 'order');
                                    addLog(`ğŸ’° åˆ°æ‰‹é‡‘é¢: ${result.order.outPrice}`, 'order');
                                    addLog(`ğŸ® ç”¨æˆ·åå­—: ${result.order.gameRoleName}`, 'order');
                                    addLog(`ğŸ†” ç”¨æˆ· ID: ${result.order.gameRoleId}`, 'order');
                                    addLog(`ğŸ’¬ ç”¨æˆ·å¤‡æ³¨: ${result.order.remark}`, 'order');
                                    
                                    saveSuccessRecord(result.order, getDynamicDelay());
                                    
                                    // æŠ¢åˆ°ä¸€å•åè‡ªåŠ¨åœæ­¢
                                    if (config.stopAfterSuccess) {
                                        stopOrderGrabber();
                                        addLog('â¹ï¸ å·²è‡ªåŠ¨åœæ­¢æŠ¢å•ï¼Œå¦‚éœ€ç»§ç»­è¯·å†æ¬¡ç‚¹å‡»å¼€å§‹', 'info');
                                    }
                                    break; // æˆåŠŸæŠ¢åˆ°ä¸€ä¸ªè®¢å•åæš‚åœ
                                } else if (result && !result.success && config.autoBlacklist) {
                                    // æŠ¢å•å¤±è´¥ä¸”å¼€å¯äº†è‡ªåŠ¨é»‘åå•ï¼Œå°†è®¢å•åŠ å…¥é»‘åå•
                                    const failedOrder = matchedOrders.find(o => o.taskId === result.taskId);
                                    if (failedOrder && !config.blacklistOrderIds.includes(failedOrder.taskId)) {
                                        config.blacklistOrderIds.push(failedOrder.taskId);
                                        saveConfigToLocal();
                                        addLog(`ğŸš« è®¢å• ${failedOrder.taskId} å·²åŠ å…¥é»‘åå•`, 'warning');
                                    }
                                }
                            }
                        }
                        
                        // è®¡ç®—å¹³å‡å“åº”æ—¶é—´
                        const totalTime = Date.now() - cycleStart;
                        config.stats.avgResponse = parseFloat(
                            ((config.stats.avgResponse * (config.stats.refreshCount - 1) + totalTime / 1000) / 
                            config.stats.refreshCount
                        ).toFixed(2));
                        updateStatsDisplay();
                        
                        // åŠ¨æ€è®¡ç®—å»¶è¿Ÿå’Œé—´éš”
                        const dynamicInterval = getDynamicInterval();
                        
                        // ç­‰å¾…åŠ¨æ€é—´éš”
                        await sleep(dynamicInterval);
                        
                    } catch (error) {
                        addLog(`âŒ è·å–è®¢å•åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                        await sleep(3000); // å‡ºé”™æ—¶ç­‰å¾…3ç§’å†é‡è¯•
                    }
                }
            }
            
            // å¸¦ç¼“å­˜çš„è®¢å•åˆ—è¡¨è·å–
            async function fetchOrderListWithCache() {
                const now = Date.now();
                
                // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
                if (config.cache.orders && now < config.cache.expiry) {
                    addLog('â™»ï¸ ä½¿ç”¨ç¼“å­˜è®¢å•æ•°æ®', 'info');
                    return config.cache.orders;
                }
                
                // è·å–æ–°æ•°æ®
                const orders = await fetchOrderList();
                
                // æ›´æ–°ç¼“å­˜
                config.cache.orders = orders;
                config.cache.expiry = now + config.cache.duration;
                
                return orders;
            }
            
            // å¹¶è¡Œè®¢å•è¿‡æ»¤
            async function filterOrdersParallel(orders) {
                return new Promise(resolve => {
                    // ä½¿ç”¨setTimeouté¿å…é˜»å¡ä¸»çº¿ç¨‹
                    setTimeout(() => {
                        const blacklistKeywords = getBlacklistKeywords();
                        const matched = [];
                        
                        for (const order of orders) {
                            // æ£€æŸ¥è®¢å•çŠ¶æ€
                            if (order.state !== 1) continue;
                            
                            // æ£€æŸ¥è®¢å•æ˜¯å¦åœ¨é»‘åå•ä¸­
                            if (config.blacklistOrderIds.includes(order.taskId)) continue;
                            
                            // åŒºåŸŸç­›é€‰
                            let areaMatch = true;
                            if (config.areaFilter !== 'all') {
                                const catName = (order.categoryName || '').toLowerCase();
                                areaMatch = (config.areaFilter === 'Q' && catName.includes('qåŒº')) || 
                                            (config.areaFilter === 'V' && catName.includes('våŒº'));
                            }
                            
                            if (!areaMatch) continue;
                            
                            // å…³é”®è¯ç­›é€‰
                            let keywordMatch = true;
                            if (config.keywords.length > 0) {
                                const taskName = (order.taskName || '').toLowerCase();
                                const taskDesc = (order.description || '').toLowerCase();
                                keywordMatch = config.keywords.some(kw => 
                                    taskName.includes(kw.toLowerCase()) || 
                                    taskDesc.includes(kw.toLowerCase())
                                );
                            }
                            
                            if (!keywordMatch) continue;
                            
                            // é»‘åå•ç­›é€‰
                            let blacklistMatch = false;
                            if (blacklistKeywords.length > 0) {
                                const remark = (order.remark || '').toLowerCase();
                                const publisherName = (order.publisherName || '').toLowerCase();
                                
                                blacklistMatch = blacklistKeywords.some(kw => 
                                    remark.includes(kw.toLowerCase()) || 
                                    publisherName.includes(kw.toLowerCase())
                                );
                            }
                            
                            if (!blacklistMatch) {
                                matched.push(order);
                            }
                        }
                        
                        resolve(matched);
                    }, 0);
                });
            }
            
            // åœæ­¢æŠ¢å•
            function stopOrderGrabber() {
                config.isRunning = false;
                
                // æ›´æ–°UI
                indicator.classList.remove('active');
                indicator.nextElementSibling.textContent = 'æœªè¿è¡Œ';
                startBtn.style.display = 'inline-flex';
                stopBtn.style.display = 'none';
                
                addLog(`â¹ï¸ å·²åœæ­¢æŠ¢å• - å…±åˆ·æ–° ${config.stats.refreshCount} æ¬¡ï¼ŒæŠ¢åˆ° ${config.stats.successCount} å•`, 'warning');
            }
            
            // è·å–è®¢å•åˆ—è¡¨
            async function fetchOrderList() {
                try {
                    const headers = {
                        "token": config.token
                    };
                    
                    const response = await fetchWithRetry(`${config.apiBaseUrl}/order/list?pageSize=10&pageNum=1&categoryId=0`, {
                        headers: headers
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.code !== 200) {
                        throw new Error(data.msg || 'è·å–è®¢å•å¤±è´¥');
                    }
                    
                    return data.rows || [];
                } catch (error) {
                    console.error('è·å–è®¢å•åˆ—è¡¨å‡ºé”™:', error);
                    throw error;
                }
            }
            
            // æŠ¢å•
            async function takeOrder(taskId) {
                try {
                    const delay = getDynamicDelay();
                    addLog(`â³ å‡†å¤‡æŠ¢å• â†’ ç­‰å¾… ${delay}ms å»¶è¿Ÿ...`, 'info');
                    
                    // åº”ç”¨åŠ¨æ€å»¶è¿Ÿ
                    await sleep(delay);
                    
                    const headers = {
                        "token": config.token,
                        "Content-Type": "application/json"
                    };
                    
                    const data = {
                        "taskId": taskId,
                        "ids": config.ids,
                        "nickname": "è‡ªåŠ¨æŠ¢å•å·¥å…·",
                        "avatar": "https://xiaolatiao.oss-cn-beijing.aliyuncs.com/uploadImg-test/wYp4xWmXfR.jpg"
                    };
                    
                    const response = await fetchWithRetry(`${config.apiBaseUrl}/order/takeOrder`, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.code === 200) {
                        // è·å–è®¢å•è¯¦æƒ…
                        const orderDetail = await getOrderDetail(taskId);
                        return { 
                            success: true, 
                            order: orderDetail 
                        };
                    } else {
                        addLog(`âš ï¸ æŠ¢å•å¤±è´¥ â†’ åŸå› : ${result.msg || 'æœªçŸ¥é”™è¯¯'}`, 'warning');
                        return { 
                            success: false, 
                            message: result.msg,
                            taskId: taskId
                        };
                    }
                } catch (error) {
                    console.error('æŠ¢å•å‡ºé”™:', error);
                    addLog(`âŒ æŠ¢å•å‡ºé”™ â†’ ${error.message}`, 'error');
                    return { 
                        success: false, 
                        message: error.message,
                        taskId: taskId
                    };
                }
            }
            
            // è·å–è®¢å•è¯¦æƒ…
            async function getOrderDetail(taskId) {
                try {
                    const headers = {
                        "token": config.token
                    };
                    
                    const response = await fetchWithRetry(`${config.apiBaseUrl}/order/getInfo?taskId=${taskId}`, {
                        headers: headers
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.code === 200) {
                        return data.data || {};
                    } else {
                        throw new Error(data.msg || 'è·å–è¯¦æƒ…å¤±è´¥');
                    }
                } catch (error) {
                    console.error('è·å–è¯¦æƒ…å¤±è´¥:', error);
                    addLog(`âš ï¸ è·å–è¯¦æƒ…å¤±è´¥ â†’ ${error.message}`, 'warning');
                    return {};
                }
            }
            
            // ä¿å­˜æˆåŠŸè®°å½•
            function saveSuccessRecord(order, delayMs) {
                const record = {
                    time: new Date().toLocaleString(),
                    taskId: order.taskId || 'æœªçŸ¥',
                    area: order.categoryName || 'æœªçŸ¥åŒºåŸŸ',
                    type: order.taskName || 'æœªçŸ¥ç±»å‹',
                    amount: order.outPrice || 'æœªçŸ¥',
                    delay: delayMs + 'ms'
                };
                
                successRecords.unshift(record); // ä»ç„¶å­˜å‚¨æ‰€æœ‰è®°å½•
                localStorage.setItem('permanentRecords', JSON.stringify(successRecords));
                loadSuccessRecords(); // è°ƒç”¨ä¿®æ”¹åçš„æ˜¾ç¤ºå‡½æ•°
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                const price = parseFloat((order.outPrice || "0").replace(/[^\d.-]/g, ""));
                if (!isNaN(price)) {
                    config.stats.unsettledTotal += price;
                    updateStatsDisplay();
                }
            }
            
            // åŠ è½½æˆåŠŸè®°å½•
            function loadSuccessRecords() {
                const records = successRecords;
                const displayCount = 3; // è¡¨æ ¼åªæ˜¾ç¤ºå‰3æ¡è®°å½•

                if (records.length === 0) {
                    recordsTable.innerHTML = '<tr><td colspan="6">ğŸ“­ æš‚æ— è®°å½•</td></tr>';
                    totalOrdersEl.textContent = '0';
                    totalAmountEl.textContent = '0';
                    return;
                }

                let html = '';
                let totalAmount = 0;

                // è®¡ç®—å…¨éƒ¨è®°å½•çš„æ€»é‡‘é¢
                records.forEach(record => {
                    if (record.amount) {
                        const price = parseFloat((record.amount || "0").replace(/[^\d.-]/g, ""));
                        if (!isNaN(price)) {
                            totalAmount += price;
                        }
                    }
                });

                // åªæ¸²æŸ“å‰3æ¡è®°å½•åˆ°è¡¨æ ¼
                const displayRecords = records.slice(0, displayCount);
                displayRecords.forEach(record => {
                    html += `
                        <tr class="table-row">
                            <td>${record.time}</td>
                            <td>${record.taskId}</td>
                            <td>${record.area}</td>
                            <td>${record.type}</td>
                            <td>${record.amount}</td>
                            <td>${record.delay}</td>
                        </tr>
                    `;
                });

                // å¦‚æœæ€»è®°å½•æ•°å¤§äºæ˜¾ç¤ºæ•°é‡ï¼Œæ·»åŠ æç¤º
                if (records.length > displayCount) {
                    html += `
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--gray);">
                                ğŸš© åªæ˜¾ç¤ºå‰${displayCount}æ¡è®°å½• (å…±${records.length}æ¡)
                            </td>
                        </tr>
                    `;
                }

                recordsTable.innerHTML = html;
                totalOrdersEl.textContent = records.length;
                totalAmountEl.textContent = totalAmount.toFixed(2); // æ˜¾ç¤ºå…¨éƒ¨è®°å½•çš„ç´¯è®¡é‡‘é¢
            }
            
            // æ·»åŠ æ—¥å¿—
            function addLog(message, type = 'info') {
                const now = new Date();
                const timeStr = now.toLocaleTimeString();
                
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry`;
                
                const timeSpan = document.createElement('span');
                timeSpan.className = 'log-time';
                timeSpan.textContent = `[${timeStr}]`;
                
                const messageSpan = document.createElement('span');
                messageSpan.className = `log-message ${type}`;
                messageSpan.textContent = message;
                
                logEntry.appendChild(timeSpan);
                logEntry.appendChild(messageSpan);
                
                logStream.appendChild(logEntry);
                logStream.scrollTop = logStream.scrollHeight;
                
                // é™åˆ¶æ—¥å¿—æ•°é‡
                if (logStream.children.length > 200) {
                    logStream.removeChild(logStream.children[0]);
                }
            }
            
            // ç¡çœ å‡½æ•°
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
    </script>
</body>
</html>
